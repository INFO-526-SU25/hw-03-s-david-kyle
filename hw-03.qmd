---
title: "HW 03"
author: "Seldon David Kyle"
format:
  html:
    embed-resources: true
toc: true
execute:
  warning: false
  error: false
  message: false
---

```{r}
#| label: load-pkgs
#| message: false
#| echo: false

if (!require("pacman")) 
  install.packages("pacman")

pacman::p_load(tidyverse,
               magick)
```

## 1 - Du Bois challenge.

```{r}
income <- read_csv("data/income.csv")
glimpse(income)

```

```{r}
library(tidyverse)
library(patchwork)

# Recode final class label for line break
income <- income |>
  mutate(
    Class = recode(Class, "$1000 AND OVER" = "$1000\nAND OVER")
  )

# === LEFT TABLE PLOT ===
label_table <- income |>
  mutate(
    Class = factor(Class, levels = rev(c(
      "$100-200", "$200-300", "$300-400", "$400-500",
      "$500-750", "$750-1000", "$1000\nAND OVER"
    ))),
    row = as.numeric(Class)
  ) |>
  ggplot(aes(y = Class)) +
  # Border for each row
  geom_tile(aes(x = 1.5, width = 2, height = 1), fill = NA, color = "black") +

  # Horizontal grid lines aligned with tile edges
  geom_segment(
    data = tibble(y = seq(0.5, 7.5, 1)),
    aes(x = 0.9, xend = 2.9, y = y, yend = y),
    inherit.aes = FALSE,
    color = "gray70", linewidth = 0.2
  ) +

  # Vertical grid lines (now with precise segment endpoints)
  geom_segment(
    data = tibble(x = c(0.9, 1.95, 2.9)),
    aes(x = x, xend = x, y = 0.5, yend = 7.5),
    inherit.aes = FALSE,
    color = "gray70", linewidth = 0.2
  ) +

  # Table text: class and income
  geom_text(aes(x = 1, label = Class), hjust = 0, size = 3.2, fontface = "bold", family = "mono") +
  geom_text(aes(x = 2, label = paste0("$", Average_Income)), hjust = 0, size = 3.2, family = "mono") +

  scale_y_discrete(limits = rev(c(
    "$100-200", "$200-300", "$300-400", "$400-500",
    "$500-750", "$750-1000", "$1000\nAND OVER"
  ))) +
  xlim(0.9, 2.9) +
  labs(title = NULL, x = NULL, y = NULL) +
  theme_void() +
  theme(
    plot.margin = margin(5, 0, 5, 5),
    axis.text.y = element_blank()
  )

# === BAR CHART PLOT ===
data_long <- income |>
  pivot_longer(cols = Rent:Other, names_to = "type", values_to = "measurement") |>
  mutate(
    type = factor(type, levels = c("Rent", "Food", "Clothes", "Tax", "Other")),
    Class = factor(Class, levels = rev(c(
      "$100-200", "$200-300", "$300-400", "$400-500",
      "$500-750", "$750-1000", "$1000\nAND OVER"
    )))
  )

# Replace 0% values with 0.1% for visibility
data_long$measurement[data_long$measurement == 0] <- 0.1

# Fill color palette
category_colors <- c(
  Rent = "black",
  Food = "mediumorchid4",
  Clothes = "lightsalmon1",
  Tax = "slategray3",
  Other = "gray75"
)

# Bar plot
bar_plot <- ggplot(data_long, aes(x = Class, y = measurement, fill = type)) +
  geom_bar(stat = "identity", width = 0.8) +
  geom_text(
    aes(label = ifelse(measurement >= 1, paste0(measurement, "%"), "")),
    position = position_stack(vjust = 0.5),
    size = 3,
    color = "white"
  ) +
  scale_y_reverse() +
  scale_fill_manual(values = category_colors) +
  coord_flip() +
  labs(
    title = "INCOME AND EXPENDITURE OF 150 BLACK FAMILIES IN ATLANTA, GA",
    subtitle = "Simplified Du Bois Reproduction",
    x = NULL, y = NULL
  ) +
  theme_minimal(base_size = 12) +
  theme(
    plot.title = element_text(face = "bold", hjust = 0, size = 12),
    axis.text.y = element_blank(),
    axis.text.x = element_blank(),
    axis.ticks.x = element_blank(),
    panel.grid.major.y = element_blank(),
    panel.grid.major.x = element_blank(),
    legend.title = element_blank(),
    legend.position = "top",
    legend.direction = "horizontal",
    legend.justification = "center"
  )

# === COMBINE TABLE AND BAR PLOT ===
label_table + bar_plot + plot_layout(widths = c(1.3, 3))


```

```{r}
unique(income$Class)
```

## 2 - COVID survey - interpret

```{r}
#| label: label-me-2

```

## 3 - COVID survey - reconstruct

## 4 - COVID survey - re-reconstruct

## 5 - COVID survey - another view
